# ASP.NET Core
# Build and test ASP.NET Core projects targeting .NET Core.
# Add steps that run tests, create a NuGet package, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

trigger:
- main

pool:
  name: MPSS Common
  vmImage: 'windows-2022'

variables:
  buildConfiguration: 'Release'

steps:
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '6.0.x'
    includePreviewVersions: true
    installationPath: $(Agent.ToolsDirectory)/dotnet

# NuGet tool installer
# Acquires a specific version of NuGet from the internet or the tools cache and adds it to the PATH. Use this task to change the version of NuGet used in the NuGet tasks.
- task: NuGetToolInstaller@1
  inputs:
    versionSpec: 6.1.0
    checkLatest: false

- task: NuGetCommand@2
  inputs:
    command: 'restore'
    restoreSolution: 'FOMS\FOMS.Api\FOMS.Api.csproj'
    feedsToUse: 'config'
    nugetConfigPath: 'C:\Users\XX_TFSAGENT_MPSS\AppData\Roaming\NuGet\NuGet.Config'
    noCache: false

#- task: DotNetCoreCLI@2
#  inputs:
#    command: 'restore'
#    projects: 'FOMS\FOMS.Api\FOMS.Api.csproj'
#    feedsToUse: 'config'
#    nugetConfigPath: 'C:\Users\XX_TFSAGENT_MPSS\AppData\Roaming\NuGet\NuGet.Config'
#    noCache: false

- task: DotNetCoreCLI@2
  inputs:
    command: 'build'
    projects: 'FOMS\FOMS.Api\FOMS.Api.csproj'
    arguments: '--configuration $(buildConfiguration) --no-restore --output $(Build.BinariesDirectory)'
    noCache: false

- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.BinariesDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/FEAPI_$(Build.BuildNumber).zip'
    replaceExistingArchive: true

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/FEAPI_$(Build.BuildNumber).zip'
    ArtifactName: 'drop'
    publishLocation: 'FilePath'
    TargetPath: '\\sapckb079\NETDEV\BuildsMPSS\NOBY\'